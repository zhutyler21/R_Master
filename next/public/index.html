<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- ... existing code ... -->
</head>
<body>
    <!-- ... existing code ... -->
    <script>
        let API_KEY = null;
        const API_URL = 'https://api.dify.ai/v1/chat-messages';

        let conversationId = null;
        let currentChatId = null;
        const userId = 'user_' + Math.random().toString(36).substr(2, 9);

        async function fetchApiKey() {
            try {
                const response = await fetch('/api/getApiKey');
                const data = await response.json();
                if (data.apiKey) {
                    API_KEY = data.apiKey;
                    console.log('API Key fetched successfully:', API_KEY); // Debugging log
                } else {
                    console.error('API Key not found in response:', data);
                }
            } catch (error) {
                console.error('Error fetching API key:', error);
            }
        }

        // ... existing code ...
    </script>
</body>
</html>